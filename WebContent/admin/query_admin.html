<!doctype html>
<html>

<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />
	
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	 <meta name="viewport" content="width=device-width, initial-scale=1" />
	<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
	<link rel="stylesheet" href="../bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
	<link rel="stylesheet"
	href="../bootstrap/3.3.7/css/bootstrap-theme.min.css">
    <script src="../js/jquery-1.12.4.min.js"></script>
	<script src="../js/jquery.tmpl.min.js"></script>
	<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="../bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="../css/main.css">
	<style type="text/css">
		.query_row{
			border-top: 1px dashed #dedede;
			overflow: hidden;
			position: relative;
			width: 100%;
		}
		.row-first{
			border-top:none;
		}
		.query_row .head{
			position: absolute;
			left: 0px;
			top: 0px;
			width:90px;
			height: 100%;
			padding: 9px;
			background: #eeeeee;
		}
		.query_row .body{
			padding: 0px 10px 0px 100px;
		}
		.body .item{
			float:left;
			padding: 9px 30px 9px 0px;
		}
		.body .item.any{
			color:red;
		}
		.item.active a,.item.active select{
			color: #fff;
			background-color: #ff5e89;
		}
		.filter{
			display: none;
		}
		.data_row{

		}
		.item img{
			width: 80px;
			height:80px;
		}
		.data_row .item{
			float: left;
			padding: 5px 80px 5px 0px;
			height: 90px;
			display: table;
		}
		.data_row .head{
			padding: 5px 10px 5px 0px;
		}
		.data_row .item>div{
			display: table-cell;
			vertical-align:middle;
		}
		.itemLabel{
			color:blue;
		}
		.data_row:hover{
			background-color:rgba(128, 128, 128, 0.13);
		}
		.nickname {
    		white-space: nowrap;
    		width: 100px;
    		overflow: hidden;
    		display: block;
    		text-overflow: ellipsis;
		}
		.selector-for-some-widget {
		  -webkit-box-sizing: content-box;
		     -moz-box-sizing: content-box;
		          box-sizing: content-box;
		}
	</style>
	<title>微营力 -- 查询</title>
</head>

<body class="home">
	<div style="width:1000px;margin: 10px auto">
		<form id="form_query">
		<br/>

		<div class="input-group" style="width:500px;margin: 10px auto">
		 <input  id="keyword"class="form-control" name="keyword" placeholder="关键字查询" aria-describedby="basic-addon2">
		 <span class="input-group-btn"> 
		 <button id="keywordBtn" class="btn btn-default" type="button">查询</button> </span>
		 </div>
        <br/>
			<div style="border: 1px solid #e8e8e8;">
			
				<div class="query_row row-first">
					<div class="head">报价</div>
					<div class ="body">
						<input class ="filter" name="quota"/>
						<span class="item any active"><a href="#" qValue="">不限</a></span>
						<span class="item"><a href="#" qValue="(param) <= 20">20元以下</a></span>
						<span class="item"><a  href="#"  qValue="(param) >=20 and (param) <= 50" >20-50元</a></span>
						<span class="item"><a  href="#" qValue="(param) >=50 and (param) <= 80" >50-80元</a></span>
						<span class="item"><a  href="#" qValue="(param) >=80 and (param) <= 100" >80-100元</a></span>
						<span class="item"><a  href="#" qValue="(param) >=100 and (param) <= 120" >100-120元</a></span>
						<span class="item"><a  href="#" qValue="(param) >=120 and (param) <= 150" >120-150元</a></span>
						<span class="item"><a  href="#" qValue="(param) >=150 and (param) <= 180" >150-180元</a></span>
						<span class="item"><a  href="#" qValue="(param) >=180 and (param) <= 250" >180-250元</a></span>
						<span class="item"><a  href="#" qValue="(param) >=250" >250以上元</a></span>
					</div>
					<div class="foot"></div>
				</div>
			
				<div class="query_row">
					<div class="head">好友数</div>
					<div class ="body">
						<input class ="filter" name="friendsCount"/>
						<span class="item any active"><a href="#" qValue="">不限</a></span>
						<span class="item"><a  href="#" qValue="(param) <= 150" >150以下</a></span>
						<span class="item"><a  href="#" qValue="(param) >=150 and (param) <= 300" >150-300</a></span>
						<span class="item"><a  href="#" qValue="(param) >=300 and (param) <= 500">300-500</a></span>
						<span class="item"><a  href="#" qValue="(param) >=500 and (param) <= 800">500-800</a></span>
						<span class="item"><a  href="#" qValue="(param) >=800 and (param) <= 1000">800-1000</a></span>
						<span class="item"><a  href="#" qValue="(param) >=1000 and (param) <= 1500">1000-1500</a></span>
						<span class="item"><a  href="#" qValue="(param) >=1500 and (param) <= 2500">1500-2500</a></span>
						<span class="item"><a  href="#" qValue="(param) >=2500 ">2500以上</a></span>
					</div>
					<div class="foot"></div>
				</div>
				<div class="query_row">
					<div class="head">性别</div>
					<div class ="body">
						<input class ="filter" name="sex"/>
						<span class="item any active"><a href="#" qValue="">不限</a></span>
						<span class="item"><a  href="#" qValue="(param) >= 50" >男多</a></span>
						<span class="item"><a  href="#" qValue="(param) < 50" >女多</a></span>
					</div>
					<div class="foot"></div>
				</div>
				<div class="query_row">
					<div class="head">地域</div>
					<div class ="body">
						<input class ="filter" name="city"/>
						<span class="item any active"><a href="#" qValue="">不限</a></span>
						<span class="item"><a  href="#" qValue="(param) ='北京' ">北京</a></span>
						<span class="item"><a  href="#" qValue="(param) ='上海' ">上海</a></span>
						<span class="item"><a  href="#" qValue="(param) ='广州' ">广州</a></span>
						<span class="item"><a  href="#" qValue="(param) ='深圳' ">深圳</a></span>
						<span class="item"><a  href="#" qValue="(param) ='杭州' ">杭州</a></span>
						<span class="item"><a  href="#" qValue="(param) ='重庆' ">重庆</a></span>
						<span class="item"><a  href="#" qValue="(param) ='南京' ">南京</a></span>
						<span class="item"><a  href="#" qValue="(param) ='武汉' ">武汉</a></span>
						<span class="item"><a  href="#" qValue="(param) ='天津' ">天津</a></span>
						<span class="item"><a  href="#" qValue="(param) ='成都' ">成都</a></span>
						<span class="item"><a  href="#" qValue="(param) ='合肥' " >合肥</a></span>
						<span class="item"> <select>
							<option value="">请选择</option>
							<option value="(param) ='芜湖'">芜湖</option>
							<option value="(param) ='淮南'">淮南</option>
							<option value="(param) ='无锡'">无锡</option>
							<option value="(param) ='苏州'">苏州</option>
							<option value="(param) ='郑州'">郑州</option>
							<option value="(param) ='东莞'">东莞</option>
							<option value="(param) ='南昌'">南昌</option>
							<option value="(param) ='宁波'">宁波</option>
							<option value="(param) ='昆明'">昆明</option>
							<option value="(param) ='包头'">包头</option>
							<option value="(param) ='呼和浩特'">呼和浩特</option>
							<option value="(param) ='济南'">济南</option>
							<option value="(param) ='青岛'">青岛</option>
							<option value="(param) ='石家庄'">石家庄</option>
							<option value="(param) ='温州'">温州</option>
							<option value="(param) ='西安'">西安</option>
							<option value="(param) ='桂林'">桂林</option>
							<option value="(param) ='太原'">太原</option>
							<option value="(param) ='沈阳'">沈阳</option>
							<option value="(param) ='哈尔滨'">哈尔滨</option>
							<option value="(param) ='贵阳'">贵阳</option>
							<option value="(param) ='兰州'">兰州</option>
							<option value="(param) ='西宁'">西宁</option>
							<option value="(param) ='乌鲁木齐'">乌鲁木齐</option>
							<option value="(param) ='拉萨'">拉萨</option>
							<option value="(param) ='长春'">长春</option>
							<option value="(param) ='银川'">银川</option>
						</select></span>

					</div>
					<div class="foot"></div>
				</div>
				<div class="query_row">
					<div class="head">行业</div>
					<div class ="body">
						<input class ="filter" name="industry"/>
						<span class="item any active"><a href="#" qValue="">不限</a></span>
						<span class="item"><a  href="#"  qValue="(param) in('电商','微商') ">电商/微商</a></span>
						<span class="item"><a  href="#" qValue="(param) ='互联网' ">互联网</a></span>
						<span class="item"><a  href="#" qValue="(param) in('传媒' ,'营销') ">传媒/营销</a></span>
						<span class="item"><a  href="#" qValue="(param) in('金融','财经') ">金融/财经</a></span>
						<span class="item"><a  href="#" qValue="(param) ='时尚'">时尚</a></span>
						<span class="item"><a  href="#" qValue="(param) ='母婴'">母婴</a></span>
						<span class="item"><a  href="#" qValue="(param) ='文娱' ">文娱</a></span>
						<span class="item"><a  href="#" qValue="(param) in('旅游', '酒店')">旅游/酒店</a></span>
						<span class="item"><a  href="#" qValue="(param) ='房地产'">房地产</a></span>
						<span class="item"><a  href="#" qValue="(param) ='游戏动漫'">游戏动漫</a></span>
						<span class="item"><a  href="#" qValue="(param) ='教育' ">教育</a></span>
						<span class="item"><a  href="#" qValue="(param) ='学生'">学生</a></span>
					</div>
					<div class="foot"></div>
				</div>
				<div class="query_row">
					<div class="head">导出</div>
					<div class ="body">
						<span class="item"><a id="excel" href="#">结果汇出Excel</a></span>
					</div>
					<div class="foot"></div>
				</div>
			</div>
		</form>
		<div style="margin-top: 20px;">
			<div id="div_loading" style="text-align: center;display: none;"><img src="../img/loading.gif"/></div>
			<div id ="div_list">

			</div>
			<div id ="loadmore" style="text-align: center;">
				<a href="javascript:void(0)">加载更多</a>
				<img src="../img/loading.gif" style="display:none;" width=60 height=60/>
			</div>
		</div>
	</div>

	<script id="dataTmpl" type="text/x-jquery-tmpl">
				<div href ="#" class="data_row">
					<div class="item head">
						<img class ="" src="../wxImage/${uin}/head.png"/>
					</div>
					<span class="item">
						<div>
						<a class ="nickname" href ="../wx.html?wxid=${uin}" target ="_blank" title="${nickName}">
							${nickName}<br/>
							${wxid}<br/>
							￥${quota}
						</a>
										
						</div>
					</span>
					<span class="item">
						<div>
							<span class="itemLabel">好友数</span>
							<br/>
							${friendsCount} ${malePercent >=50?'男多':'女多'}
						</div>
					</span>
					<span class="item" style="min-width:160px">
						<div>
							${typeof age == 'undefined' ? '--': age}岁<br/>
							${typeof city == 'undefined' ? '--': city}
						</div>
					</span>
					<span class="item" style="">
						<div>
							<span class="itemLabel">行业</span>
							<br/>
							${industry}
						</div>
					</span>
					<span class="item" style="float:right">
						<div>
							<a  href ="wx.html?wxid=${uin}" target ="_blank"><button>查看详细</button></a>
						</div>
					</span>					
					<div style="clear: both;"></div>
				</div>
	</script>
	<script>
	
		function jsonToQueryString(json) {
		    return '?' + 
		        Object.keys(json).map(function(key) {
		            return encodeURIComponent(key) + '=' +
		                encodeURIComponent(json[key]);
		        }).join('&');
		}
		var exportExcel = function(){
			var excelParam = $.extend({format:'excel'}, queryParam);
			excelParam.count= totalCount;
			excelParam.start = 0;
			$("#excel").attr("href", '../query' + jsonToQueryString(excelParam));
		}
	
	    var queryParam ={start:0, count:500};
	    var totalCount = 0;
	    var getInput = function(){
	    	var ret ={};
	    	$("input[name]").each(function(){
	    		ret[$(this).attr("name")] = $(this).val();
	    	});
	    	return ret;
	    	
	    }
		var doQuery = function(){
			queryParam.start =0;
			queryParam = $.extend(queryParam,getInput());
			$("#div_loading").show();
			$("#div_list").empty();
			$("#loadmore").hide();
			$.ajax({
				url : '../query',
				type : 'GET',
				dataType: "json",
				data :queryParam
			}).done(function(a, b, c) {
				$("#dataTmpl").tmpl(a.items).appendTo("#div_list");
				queryParam.start += a.items.length ;
				totalCount += a.items.length;
				if(a.items.length < 1){
					$('	<span style="margin: auto">没有找到任何符合条件的微信号，请更改查询条件</span>').appendTo('#div_list');
				}			
				$("#loadmore").show();
				exportExcel();
			}).fail(function(xhr, textStatus, errorThrown) {
				alert(xhr.responseText);
			}).always(function(){
				$("#div_loading").hide();
			});
		}
		var loadNextPage = function(){
			//queryParam.start = 	queryParam.start  + queryParam.count;
			$("#loadmore img").show();
			$("#loadmore a").hide();
			$.ajax({
				url : '../query',
				type : 'GET',
				dataType: "json",
				data :queryParam
			}).done(function(a, b, c) {
				queryParam.start += a.items.length ;
				totalCount += a.items.length;
				$("#dataTmpl").tmpl(a.items).appendTo("#div_list");		
				$("#loadmore a").show();
				exportExcel();
			}).fail(function(xhr, textStatus, errorThrown) {
				alert(xhr.responseText);
			}).always(function(){
				$("#loadmore img").hide();
			});
		}
		$("#loadmore a").click(function(e){
			e.preventDefault();
			loadNextPage();
		});
		$(document).ready(function() {
			$(".query_row a[qValue]").click(function(e){
				e.preventDefault();
				var parent = $(this).parents('.query_row');
				parent.find("input").val($(this).attr("qValue"));
				parent.find(".item").removeClass("active");
				$(this).parent(".item").addClass("active");
				parent.find("select").val('');
				doQuery();
			});

			$("#keywordBtn").click(function(e){
				doQuery();
			});
			$(".query_row select").change(function(){
				var parent = $(this).parents('.query_row');
				parent.find(".item").removeClass("active");
				var val = $(this).val();
				if(val ==''){
					parent.find(".item.any").addClass("active");
				}else{
					$(this).parent(".item").addClass("active");
				}
				parent.find("input").val(val);
				doQuery();
			});
			doQuery();

		});
	</script>
</body>

</html>