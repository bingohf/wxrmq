<!doctype html>
<html>

<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">


	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
	<link rel="stylesheet" href="bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
	<link rel="stylesheet"
	href="bootstrap/3.3.7/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/bootstrap-modal.css1">
	
	 <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
    <script src="js/jquery-1.12.4.min.js"></script>
	<script src="js/jquery.tmpl.min.js"></script>
	<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="js/bootstrap-modal.js1"></script>
	<script src="js/validator.js"></script>
	
	<style type="text/css">
		.navigation{
			background-color: #363a47;
			height: 100%;
			width: 240px;
			color:white;
			position: fixed;
			font-size: 16px;
			top: 0;
			left: 0;
		}
		.main-content{
			margin-left: 240px;
			background-color: rgb(239, 240, 244);
		}
		.navigation ul{
			list-style: none;
		}
		footer {
			text-align: center;
			background: #363a47;
			padding: 16px;
			color: #7a7676;
			font-size: 12px;
			position: static;
			bottom: 0;
			width: 100%;
			border-top: 1px solid #eff0f4;
		}
		.main-body{
			padding: 10px;
		}
		.panel{
			border: 1px solid #d0d0d0;
			padding: 15px 20px 15px 20px;
		}
		.table_wechat th, .table_wechat td{
			text-align: center;
		}
		img.head{
			width:80px;
			height:80px;
		}
		.navigation ul li {
    		padding: 8px 0px;
		}

	</style>

	<title>微营力</title>
</head>

<body>
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" 
					aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					更新个人信息
				</h4>
			</div>
			<div class="modal-body">
			<form role="form" class="form-horizontal">
				<div class="form-group">
					<label for="wxId" class="control-label col-sm-2">微信号</label>
					<div class="col-sm-10">
						<input class="form-control" data-val="true"   name="wxId" type="text">
					</div>
				</div>
				<div class="form-group">
					<label for="quota" class="control-label col-sm-2">报价</label>
					<div class="col-sm-10">
						<input class="form-control" data-val="true" data-val-number="字段 报价 必须是一个数字。"   name="quota" type="number" min=0 step="0.01">
					</div>
				</div>
				<div class="form-group">
					<label for="age" class="control-label col-sm-2">年龄</label>
					<div class="col-sm-10">
						<input class="form-control" data-val="true" data-val-number="字段 报价 必须是一个数字。"  onkeypress='return event.charCode >= 48 && event.charCode <= 57'step=1 min=1 name="age" type="number">
					</div>
				</div>
				<div class="form-group">
					<label for="city" class="control-label col-sm-2">城市</label>
					<div class="col-sm-10">
						<input class="form-control" data-val="true" name="city">
					</div>
				</div>
				<div class="form-group">
					<label for="industry" class= "control-label col-sm-2">行业/职业</label>
					<div class="col-sm-10">
							<select class="form-control  valid" id="Job" name="industry"><option value=""></option>
								<option value="学生">学生</option>
								<option value="白领">白领</option>
								<option value="蓝领">蓝领</option>
								<option value="模特">模特</option>
								<option value="微商">微商</option>
								<option value="自媒体">自媒体</option>
								<option value="企业家">企业家</option>
								<option value="美妆达人">美妆达人</option>
								<option value="网络红人">网络红人</option>
								<option value="个体商户">个体商户</option>
								<option value="自由职业">自由职业</option>
								<option value="IT互联网">IT互联网</option>
								<option value="其他">其他</option>
							</select>
					</div>
				</div>
	      	  </form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" 
				data-dismiss="modal">取消
			</button>
			<button type="button" class="btn btn-primary" onclick ="savePersonalInfo(this)">
				提交更改
			</button>
		</div>
	</div><!-- /.modal-content -->
</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<section>
	<div class="navigation">
		<br/>
		<ul>
			<li>微信账号管理</li>
			<li><a href="logout.jsp" style="color:#b76e33">登出</a></li>
		</ul>
	</div>
	<div class="main-content">
		<div class="main-body">
			<section class="panel">
				<table class="table_wechat">
					<thead>
						<tr style=" border-bottom-width:0px;">
							<th style="width: 40px; text-align: center; vertical-align: middle;">
								<input type="checkbox" id="chkBoxAll" name="chkBoxAll">
							</th>
							<th style="width: 300px; ">微信账号</th>
							<th style="width: 50px; ">账号类型</th>
							<th style="width: 150px; ">好友数</th>
							<th style="width: 150px; ">报价</th>
							<th style="width: 150px; ">订单数</th>
							<th style="width: 150px; ">成交数</th>
							<th style="width: 160px;  ">操作</th>
							<th nowarp=""> </th>
						</tr>
					</thead>
					<tbody id ="div_list">
					</tbody>
				</table>
			</section>
		</div>

		<footer>
			版权所有 微营力
		</footer>
	</div>
</section>
</div>
     
	<script id="dataTmpl" type="text/x-jquery-tmpl">
					<tr uin=${uin} wxId="${wxId}" age ="${age}" quota="${quota}" industry="${industry}" city ="${city}">
						<td><input type="checkbox" name="xx"/></td>
						<td><img class ="head" src="wxImage/${uin}/head.png"/>
												<a class ="nickname" href ="wx.html?wxid=${uin}&nocache=${$item.random()}" target ="_blank" title="${nickName}">${nickName}</a>				
						</div></td>
						<td>wechat</td>
						<td>${friendsCount}</td>
						<td>${quota}</td>
						<td>--</td>
						<td>--</td>
						<td><button class="btn_update" onclick="showUpdate(this)">个人信息</button></td>
					</tr>
	</script>

<script type="text/javascript">
	$(window).resize(function(){
		$(".main-body").css('min-height', ($(window).height() - $("footer").outerHeight()) + 'px');
	});
	$(window).resize();
    var showUpdate = function(sender){
    	var tr = $(sender).parents("tr").first();
    	
		$('#myModal').modal({
			keyboard: true
		});
		$('#myModal form').attr("uin",tr.attr("uin"));
		$('#myModal input[name=quota]').val(tr.attr("quota"));
		$('#myModal input[name=city]').val(tr.attr("city"));
		$('#myModal input[name=wxId]').val(tr.attr("wxId"));
		$('#myModal input[name=age]').val(tr.attr("age"));
		$('#myModal select[name=industry]').val(tr.attr("industry"));
    }

    var refreshList = function(){
    	$.ajax({
    		url : 'getWxList',
    		type : 'GET',
    		dataType: "json"
    	}).done(function(a, b, c) {
    		$("#div_list").empty();
    		$("#dataTmpl").tmpl(a,{random:function(){return Math.random();}}).appendTo("#div_list");			
    	}).fail(function(xhr, textStatus, errorThrown) {
    		alert(xhr.responseText);
    	}).always(function(){
    		$("#div_loading").hide();
    	});
    };
    var savePersonalInfo = function(sender){
    	$('form').validator();
    
    	 $.ajax({
             url : 'wxUser/' + $("form").attr("uin"),
             type : 'POST',
             data : $('form').serialize()
           }).done(function(a, b, c) {
        	   refreshList();
        		$('#myModal').modal("hide");
           }).fail(function(xhr, textStatus, errorThrown) {
             alert(xhr.responseText);
           }).always(function(){
          
           });
    };
    refreshList();

</script>
</body>

</html>